```yaml
title: Manipulating icons with Iconify Tools
```

# Manipulating icons with Iconify Tools

Iconify Tools is a NPM package for manipulating icons. See [Iconify Tools documentation](./index.md).

`include notices/tools1`

Most functions require SVG to be optimized. Therefore, before doing anything else, you should optimize icon.

## SVGO optimization {#svgo}

Function `[func]SVGO` optimizes icon.

Parameters:

1. `[class]SVG` instance.
2. Optional options object.

```js
tools
	.SVGO(svg)
	.then((svg) => {
		// svg variable is the same as in argument. Optimizer does not create new instance of SVG class
		console.log('Optimized SVG:', svg.toString());
	})
	.catch((err) => {
		console.error(err);
	});
```

Want to optimize an entire collection? Use collection's `[func]promiseAll` function:

```js
collection
	.promiseAll((svg) => tools.SVGO(svg))
	.then((results) => {
		console.log('Optimized entire collection');
	})
	.catch((err) => {
		console.error(err);
	});
```

Some of available options (second parameter):

- `[prop]mergePaths`, `[type]boolean`. Merges SVG paths to reduce icon size. The default value is `[bool]false`.
- `[prop]convertShapeToPath`, `[type]boolean`. Converts SVG shapes to paths. The default value is `[bool]true`.
- `[prop]plugins`. List of SVGO plug-ins. If set, it will override default plug-ins list and options mentioned above are ignored.
- `[prop]doublePass`, `[type]boolean`. If enabled, runs optimization process twice. Sometimes running optimization twice improves result. The default value is `[bool]false`.

## Cropping images {#crop}

Function `[func]Crop` removes empty spaces around icon content.

Important: this function requires PhantomJS to be installed and accessible from command line! PhantomJS has been deprecated for a while, but you can still install it using HomeBrew.

Parameters:

1. `[class]SVG` instance or `[class]Collection` instance.

How to crop one icon:

```js
tools
	.Crop(svg)
	.then((svg) => {
		console.log('Cropped SVG: ' + svg.toString());
	})
	.catch((err) => {
		console.error(err);
	});
```

How to crop entire collection:

```js
tools
	.Crop(collection)
	.then((collection) => {
		console.log('Cropped ' + svg.length() + ' images');
	})
	.catch((err) => {
		console.error(err);
	});
```

How does `[func]Crop()` function work? By drawing SVG on canvas and checking all 4 sides for transparent pixels. First it appends space on all sides of SVG, until all sides have nothing but empty pixels. Then it slowly cuts all sides until it reaches pixels that aren't empty. Process doesn't take long because script checks pixels in bulk by zooming in.

When it crops `[class]SVG` or `[class]Collection` instance (like in examples above), each `[class]SVG` instance receives additional properties that you might want to use later: `[prop]_cropData`. `[prop]_cropData` is an object with list of cropped edges: `[prop]left`, `[prop]top`, `[prop]right`, `[prop]bottom`.

## Tags validation {#tags}

Function `[func]Tags` checks elements used in SVG, changes stylesheet into inline style and removes useless attributes.

Stylesheet parser is very simple, it parses only the basic stylesheets that are generated by some image editors. If SVG contains fishy elements that aren't vector images, such as bitmaps or scripts, it will reject with error message.

Important! Before running this function, you need to optimize SVG using `[func]tools.SVGO()`.

```js
tools
	.Tags(svg)
	.then((svg) => {
		console.log('Cleaned up tags in SVG: ' + svg.toString());
	})
	.catch((err) => {
		console.error(err);
	});
```

This function is used for cleaning up SVG that contain a lot of junk code.

## Extracting palette from SVG {#get-palette}

Function `[func]GetPalette` extracts list of colors used in icon.

This is useful if you don't know if SVG is colored or monotone.

Result is object with 2 properties:

- `[prop]colors`, `[type]string[]`: array of colors.
- `[prop]notices`, `[type]string[]`: array of error messages.

Usage:

```js
tools.GetPalette(svg).then(result => {
    console.log('Colors used in SVG: ' + result.colors.join(', ');
    if (result.notices.length) {
        result.notices.forEach(notice => console.warn(notice));
    }
}).catch(err => {
    console.error(err);
});
```

To use it with entire icon set, use `[class]Collection`'s `[func]promiseAll` function:

```js
collection.promiseAll(svg => tools.GetPalette(svg)).then(result => {
    Object.keys(results).forEach(key => {
        console.log('Colors found in image ' + key + ': ' + result[key].colors.join(', ');
    });
}).catch(err => {
    console.error(err);
});
```

## Replacing palette in SVG {#change-palette}

Function `[func]ChangePalette` changes colors in SVG and adds colors to shapes that are missing colors.

Parameters:

1. `[class]SVG` instance.
2. Color changes, `[type]object` or `[type]string`.

Color changes object is a list of key/value pairs, where key is the old color, value is the new color.

Colors that are formatted differently are treated differently. For example, `[str]#fff`, `[str]#ffffff` and `[str]white` are considered to be different colors. Use `[func]GetPalette` before changing palette to get list of colors because that function will also treat those colors as separate colors and will return them in the same format as in SVG.

Reserved keywords in color changes object:

- `[prop]add`: color to add to shapes that are missing color. This is used when shape has `[prop]fill` or `[prop]stroke`, but does not have color value.
- `[prop]default`: default replacement for colors that aren't listed in color changes.

Examples:

```js
tools
	.ChangePalette(svg, {
		'#ff8000': '#0080ff',
		'#123': '#234',
	})
	.then((svg) => {
		// Variable "svg" in result is the same as in first parameter of ChangePalette.
		// Function changes existing SVG instance
		console.log('Changed palette');
	})
	.catch((err) => {
		console.error(err);
	});
```

Code above will change `[str]#ff8000` to `[str]#0080ff` and `[str]#123` to `[str]#234`.

```js
tools
	.ChangePalette(svg, 'red')
	.then((svg) => {
		console.log('Added palette to elements without palette');
	})
	.catch((err) => {
		console.error(err);
	});
```

Code above will add color `[str]"red"` to all elements that do not have color. It is identical to this:

```js
tools
	.ChangePalette(svg, {
		add: 'red',
	})
	.then((svg) => {
		console.log('Added palette to elements without palette');
	})
	.catch((err) => {
		console.error(err);
	});
```

You can also change all colors by using keyword `[str]"default"`:

```js
tools
	.ChangePalette(svg, {
		default: 'green',
	})
	.then((svg) => {
		console.log('Changed all colors to green');
	})
	.catch((err) => {
		console.error(err);
	});
```

Or you can combine all those attributes:

```js
tools
	.ChangePalette(svg, {
		'default': 'green',
		'add': '#000',
		'#123': '#234',
	})
	.then((svg) => {
		console.log(
			'Changed all colors to green, except for #123 that was changed to #234, added black color to elements without color'
		);
	})
	.catch((err) => {
		console.error(err);
	});
```

Primary use of this function in Iconify is to replace all colors in monotone icons with `[str]"currentColor"` keyword and add it to shapes that are missing color values:

```js
collection
	.promiseAll((svg) =>
		tools.ChangePalette(svg, {
			default: 'currentColor',
			add: 'currentColor',
		})
	)
	.then(() => {
		console.log('Changed color to currentColor');
	})
	.catch((err) => {
		console.error(err);
	});
```

## Indexing shapes {#index-shapes}

Function `[func]IndexShapes` is used to add unique numbers to each shape and count shapes.

This function is intended to be used when calculating stroke animations.

Parameters:

1. `[class]SVG` instance.
2. Options object.

Options object properties:

- `[prop]ignoreTags`, `[type]string[]`. List of tags to ignore.
- `[prop]shapeTags`, `[type]string[]`. List of tags that are considered to be shapes.
- `[prop]shapeStartIndex`, `[type]number`. Index for first shape, default is `[num]0`.
- `[prop]shapeAttribute`, `[type]string`. Attribute to add to tags, default value is `[str]data-shape-index`.
- `[prop]shapeAttributeValue`, `[type]string`. Value for attribute mentioned above. Keyword `[str]{index}` is replaced by index number. The default value is `[str]"{index}"`.
- `[prop]remove`, `[type]boolean`. If true, function will remove attributes instead of adding attributes.
- `[prop]shapeCallback`, `[type]function`. Callback to call for each shape. See `[file]src/shapes/options.js` for details.
- `[prop]returnNodes`, `[type]boolean`. If true, function will return nodes as array instead of returning number of nodes.

```js
tools
	.IndexShapes(svg, {
		// Attribute to set
		shapeAttribute: 'data-shape-index',
		// Attribute value. {index} is replaced with index, incrementing with each shape
		shapeAttributeValue: '{index}',
	})
	.then((shapesCount) => {
		console.log(
			'Added data-shape-index attribute to ' + shapesCount + ' shapes.'
		);
	})
	.catch((err) => {
		console.error(err);
	});
```

## Getting shape lengths {#shape-length}

Function `[func]ShapeLength` returns lengths of all shapes as well as all shapes as `[type]cheerio` objects.

Important: this function requires PhantomJS to be installed and accessible from command line! PhantomJS has been deprecated for a while, but you can still install it using HomeBrew.

Parameters:

1. `[class]SVG` instance.

```js
tools
	.ShapeLength(svg)
	.then((results) => {
		console.log('Found ' + results.length + ' shapes:');
		results.forEach((result) => {
			console.log(
				'Shape ' +
					result.$node.get(0).tagName +
					' has length of ' +
					result.length
			);
		});
	})
	.catch((err) => {
		console.error(err);
	});
```
